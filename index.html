<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Simulação de Buraco Negro</title>
  <meta name="description" content="Simulação interativa de um buraco negro usando WebGL.">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css">
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <canvas id="glscreen"></canvas>

  <!-- Vertex Shader -->
  <script id="vertex-shader" type="x-shader/x-vertex">
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    varying vec2 v_texCoord;
    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
      v_texCoord = a_texCoord;
    }
  </script>

  <!-- Fragment Shader -->
  <script id="fragment-shader" type="x-shader/x-fragment">
    precision mediump float;
    uniform sampler2D u_image;
    varying vec2 v_texCoord;

    uniform vec2 u_resolution;
    uniform vec2 u_mouse;
    uniform float u_mass;
    uniform float u_time;

    const float PI = 3.14159265359;

    vec2 rotate(vec2 mt, vec2 st, float angle) {
      float cosVal = cos(angle * PI);
      float sinVal = sin(angle * PI);

      float nx = (cosVal * (st.x - mt.x)) - (sinVal * (st.y - mt.y)) + mt.x;
      float ny = (sinVal * (st.x - mt.x)) + (cosVal * (st.y - mt.y)) + mt.y;
      return vec2(nx, ny);
    }

    void main() {
      vec2 st = v_texCoord;
      vec2 mt = u_mouse / u_resolution;

      float dx = st.x - mt.x;
      float dy = st.y - mt.y;

      float dist = sqrt(dx * dx + dy * dy);
      float pull = u_mass / (dist * dist);

      vec2 r = rotate(mt, st, pull);
      vec4 imgColor = texture2D(u_image, r);

      vec3 color = imgColor.rgb - vec3(pull * 0.25);

      gl_FragColor = vec4(color, 1.0);
    }
  </script>

  <!-- Script -->
  <script src="./script.js"></script>
</body>
</html>
